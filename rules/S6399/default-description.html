<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, are tainted with user-controlled inputs. Therefore, they should always be considered untrusted.</p>
</div>
<div class="paragraph">
<p>XML injection occurs when user-controlled input is embedded into XML syntax. In such a scenario, an attacker can abuse the XML syntax and inject arbitrary XML elements. This can lead to cross-site scripting issues or denial-of-service attacks.</p>
</div>
<div class="paragraph">
<p>In addition, the application may parse the XML document with a weakly configured XML parser (namely, a parser with external entity support enabled).
In this case, an XML External Entity (XXE) injection would expose the application to sensitive file disclosure or server-side request forgeries (SSRF).</p>
</div>
<div class="paragraph">
<p>An attacker can also elevate privileges if the XML data is used for authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_noncompliant_code_example">Noncompliant Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String xml = "&lt;node id=\""+req.getParameter("id")+\"&gt;&lt;/node&gt;";
  FileOutputStream fos = new FileOutputStream("output.xml");
  fos.write(xml.getBytes(Charset.forName("UTF-8")));  // Noncompliant
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>javax.xml.parsers.DocumentBuilder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String xml = "&lt;node id=\""+req.getParameter("id")+\"&gt;&lt;/node&gt;";

  DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
  DocumentBuilder builder = factory.newDocumentBuilder();
  Document doc = builder.parse(new InputSource(new StringReader(xml)));  // Noncompliant
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String id = req.getParameter("id");
  if(id.matches("^[A-Za-z0-9_]+$")) {
    String xml = "&lt;node id=\""+id+\"&gt;&lt;/node&gt;";
    FileOutputStream fos = new FileOutputStream("output.xml");
    fos.write(xml.getBytes(Charset.forName("UTF-8")));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>javax.xml.parsers.DocumentBuilder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String xml = "&lt;node&gt;&lt;/node&gt;;

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document doc = builder.parse(new InputSource(new StringReader(xml)));  // Noncompliant
    Element element = (Element) doc.getElementsByTagName("something").item(0);
    element.setAttribute("id", req.getParameter("id"));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection">OWASP Top 10 2017 Category A1</a> - Injection</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/20">MITRE, CWE-20</a> - Improper Input Validation</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/76">MITRE, CWE-76</a> - Improper Neutralization of Equivalent Special Elements</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to not construct XML documents directly from user-controlled data.</p>
</div>
</div>
</div>
</div>